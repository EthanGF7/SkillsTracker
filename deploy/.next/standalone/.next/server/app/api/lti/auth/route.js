"use strict";(()=>{var e={};e.id=720,e.ids=[720],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},5184:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>c});var a=r(3278),n=r(5002),i=r(4877),o=r(1309),p=r(7516),u=r(1067);let l=new Map;async function c(e){try{let t=await e.json();if(!t.iss||!t.login_hint||!t.target_link_uri)throw new p.t("MISSING_REQUIRED_PARAMS",{required:["iss","login_hint","target_link_uri"],received:Object.keys(t)});let r=process.env.ALLOWED_PLATFORMS?JSON.parse(process.env.ALLOWED_PLATFORMS):{};if(!r[t.iss])throw new p.t("INVALID_ISSUER",{iss:t.iss});let s=(0,u.aV)(),a=(0,u.NH)();l.set(s,{nonce:a,expires:Date.now()+3e5,targetUri:t.target_link_uri,iss:t.iss});let n=new URL(r[t.iss].authEndpoint);return n.searchParams.append("scope","openid"),n.searchParams.append("response_type","id_token"),n.searchParams.append("client_id",t.client_id||process.env.LTI_CLIENT_ID||""),n.searchParams.append("redirect_uri",process.env.LTI_REDIRECT_URI||""),n.searchParams.append("login_hint",t.login_hint),n.searchParams.append("state",s),n.searchParams.append("nonce",a),n.searchParams.append("prompt","none"),t.lti_message_hint&&n.searchParams.append("lti_message_hint",t.lti_message_hint),o.NextResponse.json({url:n.toString()})}catch(e){if(console.error("Error en autenticaci\xf3n LTI:",e),e instanceof p.t)return o.NextResponse.json({error:e.code,details:e.details},{status:400});return o.NextResponse.json({error:"INTERNAL_SERVER_ERROR"},{status:500})}}setInterval(()=>{let e=Date.now();for(let[t,r]of l.entries())r.expires<e&&l.delete(t)},3e5);let d=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/lti/auth/route",pathname:"/api/lti/auth",filename:"route",bundlePath:"app/api/lti/auth/route"},resolvedPagePath:"C:\\Users\\ethan\\Downloads\\login-page (1) (3)\\login-page (1)\\app\\api\\lti\\auth\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:m}=d,_="/api/lti/auth/route";function f(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},7516:(e,t,r)=>{r.d(t,{t:()=>s});class s extends Error{constructor(e,t){super(`LTI Error: ${e}`),this.code=e,this.details=t,this.name="LTIError",Error.captureStackTrace&&Error.captureStackTrace(this,s)}}},1067:(e,t,r)=>{r.d(t,{NH:()=>p,WX:()=>i,aV:()=>u,hW:()=>c,kt:()=>o,rY:()=>l});var s=r(7516),a=r(4770),n=r.n(a);async function i(e){try{let[t,r,s]=e.split(".");return JSON.parse(Buffer.from(r,"base64").toString())}catch(e){throw new s.t("TOKEN_VERIFICATION_FAILED",{cause:e})}}async function o(e){try{let t={...e,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+86400},r=Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64url"),s=Buffer.from(JSON.stringify(t)).toString("base64url"),a=n().createHmac("sha256",process.env.SESSION_SECRET||"temporary-secret").update(`${r}.${s}`).digest("base64url");return`${r}.${s}.${a}`}catch(e){throw new s.t("TOKEN_CREATION_FAILED",{cause:e})}}function p(){return n().randomBytes(32).toString("hex")}function u(){return n().randomBytes(32).toString("hex")}function l(e){return["iss","sub","aud","exp","iat","nonce","https://purl.imsglobal.org/spec/lti/claim/message_type","https://purl.imsglobal.org/spec/lti/claim/version","https://purl.imsglobal.org/spec/lti/claim/deployment_id"].every(t=>e.hasOwnProperty(t))}function c(e){let t={"http://purl.imsglobal.org/vocab/lis/v2/institution/person#Administrator":"admin","http://purl.imsglobal.org/vocab/lis/v2/institution/person#Instructor":"instructor","http://purl.imsglobal.org/vocab/lis/v2/institution/person#Student":"student"};return e.map(e=>t[e]||"user")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[140,833],()=>r(5184));module.exports=s})();